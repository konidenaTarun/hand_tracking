<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hand Cursor Control</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #000;
    font-family: Arial, sans-serif;
    cursor: none;
  }
  video {
    position: absolute;
    transform: scaleX(-1);
    display: none;
  }
  canvas {
    position: absolute;
    top: 0;
    left: 0;
  }
  #cursor {
    position: fixed;
    width: 20px;
    height: 20px;
    background: #00ffff;
    border-radius: 50%;
    pointer-events: none;
    box-shadow: 0 0 20px #00ffff, 0 0 40px #00ffff;
    transform: translate(-50%, -50%);
    z-index: 9999;
    transition: width 0.2s, height 0.2s;
  }
  #cursor.pinch {
    width: 30px;
    height: 30px;
    background: #ff00ff;
    box-shadow: 0 0 20px #ff00ff, 0 0 40px #ff00ff;
  }
  #status {
    position: fixed;
    top: 20px;
    left: 20px;
    color: #00ffff;
    background: rgba(0, 0, 0, 0.8);
    padding: 15px 20px;
    border-radius: 10px;
    font-size: 14px;
    z-index: 1000;
    max-width: 320px;
    border: 1px solid rgba(0, 255, 255, 0.3);
  }
  #startBtn {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 20px 40px;
    font-size: 18px;
    background: linear-gradient(135deg, #00ffff, #00aaff);
    color: #000;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
    z-index: 10000;
    transition: all 0.3s;
  }
  #startBtn:hover {
    transform: translate(-50%, -50%) scale(1.05);
    box-shadow: 0 0 40px rgba(0, 255, 255, 0.8);
  }
  #startBtn.hidden {
    display: none;
  }
  .status-line {
    margin: 8px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .status-label {
    margin-right: 10px;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body>
<button id="startBtn">üìπ Start Hand Tracking</button>
<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>
<div id="cursor"></div>
<div id="status" style="display: none;">
  <div class="status-line"><span class="status-label">üìπ Camera:</span> <span id="cam-status">Initializing...</span></div>
  <div class="status-line"><span class="status-label">‚úã Hand:</span> <span id="hand-status">Not detected</span></div>
  <div class="status-line"><span class="status-label">üëÜ Gesture:</span> <span id="gesture-status">None</span></div>
  <div class="status-line"><span class="status-label">üìç Position:</span> <span id="pos-status">-</span></div>
</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const cursor = document.getElementById("cursor");
const startBtn = document.getElementById("startBtn");
const statusDiv = document.getElementById("status");
const camStatus = document.getElementById("cam-status");
const handStatus = document.getElementById("hand-status");
const gestureStatus = document.getElementById("gesture-status");
const posStatus = document.getElementById("pos-status");

// Set canvas size
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Smoothed cursor position
let curX = window.innerWidth / 2;
let curY = window.innerHeight / 2;
const smoothing = 0.3; // Lower = smoother but slower

// Calculate distance between two points
function distance(p1, p2) {
  return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
}

// MediaPipe Hands setup
const hands = new Hands({
  locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.5,
  minTrackingConfidence: 0.5
});

hands.onResults((results) => {
  // Clear canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
    const landmarks = results.multiHandLandmarks[0];
    
    // Update hand status
    handStatus.textContent = "Detected ‚úì";
    handStatus.style.color = "#00ff00";
    
    // Draw hand landmarks on canvas (optional visualization)
    ctx.fillStyle = "#00ffff";
    for (let landmark of landmarks) {
      const x = (1 - landmark.x) * canvas.width; // Mirror for natural movement
      const y = landmark.y * canvas.height;
      ctx.beginPath();
      ctx.arc(x, y, 3, 0, 2 * Math.PI);
      ctx.fill();
    }
    
    // Use index finger tip (landmark 8) for cursor position
    const indexTip = landmarks[8];
    const targetX = (1 - indexTip.x) * window.innerWidth;
    const targetY = indexTip.y * window.innerHeight;
    
    // Smooth movement
    curX += (targetX - curX) * smoothing;
    curY += (targetY - curY) * smoothing;
    
    // Update cursor position
    cursor.style.left = curX + "px";
    cursor.style.top = curY + "px";
    
    // Update position status
    posStatus.textContent = `${Math.round(curX)}, ${Math.round(curY)}`;
    
    // Detect pinch gesture (thumb and index finger close together)
    const thumbTip = landmarks[4];
    const dist = distance(
      {x: thumbTip.x, y: thumbTip.y},
      {x: indexTip.x, y: indexTip.y}
    );
    
    if (dist < 0.05) {
      cursor.classList.add("pinch");
      gestureStatus.textContent = "Pinch ü§è";
    } else {
      cursor.classList.remove("pinch");
      gestureStatus.textContent = "Point üëÜ";
    }
  } else {
    handStatus.textContent = "Not detected";
    handStatus.style.color = "#ff6666";
    gestureStatus.textContent = "None";
  }
});

// Start button handler
startBtn.addEventListener("click", async () => {
  startBtn.textContent = "‚è≥ Starting...";
  startBtn.disabled = true;
  
  try {
    // Initialize camera
    const camera = new Camera(video, {
      onFrame: async () => {
        try {
          await hands.send({ image: video });
        } catch (err) {
          console.error("Error processing frame:", err);
        }
      },
      width: 640,
      height: 480
    });

    await camera.start();
    
    // Success - hide button and show status
    startBtn.classList.add("hidden");
    statusDiv.style.display = "block";
    camStatus.textContent = "Active ‚úì";
    camStatus.style.color = "#00ff00";
    
  } catch (err) {
    console.error("Camera error:", err);
    startBtn.textContent = "‚ùå Camera Access Denied";
    startBtn.style.background = "linear-gradient(135deg, #ff6666, #ff3333)";
    
    setTimeout(() => {
      startBtn.textContent = "üîÑ Try Again";
      startBtn.disabled = false;
      startBtn.style.background = "linear-gradient(135deg, #00ffff, #00aaff)";
    }, 2000);
  }
});

// Handle window resize
window.addEventListener("resize", () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
</script>
</body>
</html>